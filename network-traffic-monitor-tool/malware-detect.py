import taskA_2
import taskB
import taskC
import argparse

def real_time_mode(directory, signature_file, output_file):
    taskC.start_real_time(directory, signature_file, output_file)

def scan_mode(directory, signature_file, output_file):
    #Run scan and show results
    scanner = taskB.MalwareScanner(signature_file, output_file)
    results = scanner.scan(directory)
    
    bad = [r for r in results if r['malicious']]
    print(f"\nScanned {len(results)} files")
    print(f"Found {len(bad)} threats")

    if bad:
        print("\nThreats found:")
        for b in bad:
            print(f"\nFile: {b['path']}")
            print(f"Type: {b['type']}")
            print(f"Level: {b['level']}")
            print(f"Date: {b['date']}")

def main():
    
    parser = argparse.ArgumentParser()
    parser.add_argument('-d', '--directory', required=True)
    parser.add_argument('-s', '--signature-file', required=True)
    parser.add_argument('-o', '--output-file')
    parser.add_argument('-r', action = 'store_true')
    args = parser.parse_args()

    if args.output_file:
        outfile = args.output_file
    else:
        outfile = "report.log"

    if args.r:
        real_time_mode(args.directory, args.signature_file, args.output_file)
    else:
        scan_mode(args.directory, args.signature_file, args.output_file)

if __name__ == '__main__':
    main()    
